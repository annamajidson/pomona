<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>About — Pomona</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Almendra+Display&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;1,300&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #080808;
    min-height: 100vh;
    overflow-y: auto;
    font-family: 'Almendra Display', serif;
  }

  /* ---- Orchard background ---- */
  .orchard-bg {
    position: fixed; inset: 0;
    z-index: 0;
    pointer-events: none;
    opacity: 0;
    animation: fade-in 3s ease-out 2s forwards;
  }
  .orchard-bg svg { width: 100%; height: 100%; }

  /* ---- Chalk dust ---- */
  .chalk-dust { position: fixed; inset: 0; pointer-events: none; z-index: 1; }
  .dust-particle {
    position: absolute; width: 2px; height: 2px;
    background: rgba(255,255,255,0.12); border-radius: 50%;
    animation: float-dust linear infinite;
  }
  @keyframes float-dust {
    0%   { transform: translateY(0) translateX(0); opacity: 0; }
    10%  { opacity: 0.25; }
    90%  { opacity: 0.08; }
    100% { transform: translateY(-100px) translateX(20px); opacity: 0; }
  }

  /* ---- Vignette ---- */
  .vignette {
    position: fixed; inset: 0;
    background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.72) 100%);
    pointer-events: none; z-index: 2;
  }

  /* ---- Column accents ---- */
  .column-accent {
    position: fixed; width: 1px;
    background: linear-gradient(to bottom, transparent, rgba(230,225,215,0.08) 20%, rgba(230,225,215,0.12) 50%, rgba(230,225,215,0.08) 80%, transparent);
    top: 5%; bottom: 5%; z-index: 1;
  }
  .column-accent.left  { left: 4%; }
  .column-accent.right { right: 4%; }

  /* ---- Page title ---- */
  .page-title {
    position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
    z-index: 10;
    font-family: 'Almendra Display', serif; font-size: 1.05rem;
    color: rgba(230,225,215,0.35); letter-spacing: 0.38em; text-transform: uppercase;
    opacity: 0; animation: fade-in 1.5s ease-out 0.5s forwards;
  }

  /* ---- Back link ---- */
  .back-link {
    position: fixed; bottom: 30px; left: 7%; z-index: 10;
    font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: 0.8rem;
    color: rgba(230,225,215,0.3); letter-spacing: 0.14em; text-decoration: none;
    transition: color 0.4s ease;
    opacity: 0; animation: fade-in 1.5s ease-out 0.9s forwards;
  }
  .back-link:hover { color: rgba(230,225,215,0.65); }

  /* ---- Lang toggle ---- */
  .lang-toggle {
    position: fixed; top: 30px; left: 7%; z-index: 10;
    display: flex; gap: 10px; align-items: center;
    opacity: 0; animation: fade-in 1.5s ease-out 0.9s forwards;
  }
  .lang-btn {
    font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: 0.78rem;
    color: rgba(230,225,215,0.28); letter-spacing: 0.18em; text-transform: uppercase;
    background: none; border: none; cursor: pointer; padding: 0;
    transition: color 0.35s ease;
  }
  .lang-btn:hover { color: rgba(230,225,215,0.6); }
  .lang-btn.active { color: rgba(230,225,215,0.72); border-bottom: 1px solid rgba(230,225,215,0.3); }
  .lang-sep { color: rgba(230,225,215,0.15); font-family: 'Cormorant Garamond', serif; font-size: 0.75rem; }

  @keyframes fade-in { to { opacity: 1; } }

  /* ---- Logo ---- */
  .logo-container {
    position: fixed; bottom: 26px; left: 50%; transform: translateX(-50%);
    z-index: 10;
    opacity: 0; animation: fade-in 1.5s ease-out 0.8s forwards;
  }
  .logo-container img { height: 38px; width: auto; opacity: 0.45; transition: opacity 0.4s ease; }
  .logo-container img:hover { opacity: 0.75; }

  /* ---- Fig widget ---- */
  .fig-widget {
    position: fixed; top: 22px; right: 6%; z-index: 20;
    display: flex; flex-direction: column; align-items: flex-end;
    opacity: 0; animation: fade-in 1.5s ease-out 1.1s forwards;
  }
  .fig-toggle {
    cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
  }
  .fig-toggle:hover { transform: scale(1.12); }
  .fig-toggle:hover .fig-label { opacity: 0.9; }
  .fig-svg { width: 52px; height: 60px; }
  .fig-track {
    font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: 0.62rem;
    color: rgba(230,225,215,0.6); letter-spacing: 0.22em; text-transform: uppercase;
    opacity: 0.75;
  }
  .fig-label {
    font-family: 'Cormorant Garamond', serif; font-weight: 300; font-size: 0.68rem;
    color: rgba(230,225,215,0.45); letter-spacing: 0.13em; opacity: 0.4; transition: opacity 0.3s ease;
  }
  .fig-playing-dot {
    width: 5px; height: 5px; border-radius: 50%; background: rgba(230,225,215,0.5);
    margin-top: 2px; opacity: 0; transition: opacity 0.4s ease;
    animation: pulse-dot 1.8s ease-in-out infinite;
  }
  .fig-playing-dot.active { opacity: 1; }
  @keyframes pulse-dot {
    0%,100% { transform: scale(1); opacity: 0.5; }
    50%      { transform: scale(1.5); opacity: 1; }
  }
  .player-panel {
    margin-top: 10px; width: 290px; background: rgba(8,8,8,0.97);
    border: 1px solid rgba(230,225,215,0.06); border-radius: 1px; overflow: hidden;
    max-height: 0; opacity: 0;
    transition: max-height 0.65s cubic-bezier(0.22,1,0.36,1), opacity 0.45s ease, border-color 0.4s ease;
  }
  .player-panel.open { max-height: 310px; opacity: 1; border-color: rgba(230,225,215,0.13); }
  .player-panel iframe { display: block; width: 100%; height: 300px; border: none; filter: grayscale(1) contrast(1.05) brightness(0.92); }

  /* ---- Main layout ---- */
  .main-layout {
    display: flex; flex-direction: column; align-items: center;
    padding: 90px 8% 120px; position: relative; z-index: 5;
  }

  /* ---- "eat the apple" prompt ---- */
  .eat-prompt {
    font-family: 'Cormorant Garamond', serif; font-weight: 300; font-style: italic;
    font-size: 1.05rem; color: rgba(230,225,215,0.48); letter-spacing: 0.2em;
    margin-bottom: 28px;
    opacity: 0; animation: fade-in 1.8s ease-out 1.6s forwards;
    transition: opacity 1s ease; pointer-events: none;
  }
  .eat-prompt.hidden { opacity: 0 !important; animation: none; }

  /* ---- Apple container ---- */
  .apple-side {
    position: relative; width: 720px; height: 780px;
    overflow: hidden;
    opacity: 0; animation: fade-in 2s ease-out 1.3s forwards;
  }

  /* Bio text — above canvas, fades in as apple is eaten */
  .bio-inside {
    position: absolute; top: 258px; left: 143px; right: 143px; bottom: 46px;
    z-index: 3; overflow: hidden;
    display: flex; flex-direction: column; gap: 8px;
    opacity: 0;
    transition: opacity 0.04s linear;
    pointer-events: none;
  }
  .bio-para {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 15px; font-weight: 700; line-height: 1.5; color: rgba(230,225,215,0.95);
    letter-spacing: 0.01em;
  }

  /* Canvas: drawn with outline, erased on click, fades out as apple is eaten */
  #appleFill {
    position: absolute; top: 0; left: 0; width: 720px; height: 780px;
    z-index: 2; cursor: inherit;
    transition: opacity 0.25s ease;
  }

  /* Bite chalk-dust particles */
  .bite-dust {
    position: fixed; width: 3px; height: 3px; background: rgba(230,225,215,0.6);
    border-radius: 50%; pointer-events: none; z-index: 30;
    animation: bite-particle 1s ease-out forwards;
  }
  @keyframes bite-particle {
    0%   { opacity: 1; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--dx),var(--dy)) scale(0.3); }
  }

  /* ---- Sun + day inversion ---- */
  html { transition: filter 2.8s cubic-bezier(0.4, 0, 0.2, 1); }
  html.inverted { filter: invert(1); }

  .sun {
    position: fixed;
    width: 300px; height: 300px; border-radius: 50%;
    left: -80px; top: 100vh;
    transform: translateY(60px);
    background: radial-gradient(circle at 50% 55%,
      #ffee99 0%, #ffaa22 18%, #ff5500 42%, #cc1100 66%, transparent 100%);
    z-index: 100; pointer-events: none; opacity: 0;
    filter: invert(1);
  }
  .sun.rising {
    animation: sun-rise 9s forwards;
  }
  @keyframes sun-rise {
    0%   { transform: translateY(60px) scale(1); opacity: 0;
           animation-timing-function: cubic-bezier(0.18, 0.85, 0.32, 1); }
    7%   { opacity: 1; }
    58%  { transform: translateY(calc(-100vh - 100px)) scale(1); opacity: 1;
           box-shadow: 0 0 50px 20px rgba(255,110,10,0.45),
                       0 0 140px 55px rgba(210,55,0,0.28),
                       0 0 280px 110px rgba(170,20,0,0.14);
           animation-timing-function: ease-in-out; }
    100% { transform: translateY(calc(-100vh - 60px)) scale(0.38); opacity: 0.35;
           box-shadow: 0 0 18px 6px rgba(255,110,10,0.3),
                       0 0 45px 18px rgba(210,55,0,0.18),
                       0 0 90px 36px rgba(170,20,0,0.1); }
  }

  /* ---- Stars ---- */
  .star-field { position: fixed; inset: 0; z-index: 3; pointer-events: none; }
  .star {
    position: absolute; border-radius: 50%;
    background: rgba(230,225,215,1);
    animation: twinkle ease-in-out infinite;
  }
  @keyframes twinkle {
    0%, 100% { opacity: 0.12; transform: scale(0.7); }
    50%       { opacity: 1;   transform: scale(1.25); }
  }

  /* ---- Birds ---- */
  #birdField {
    position: fixed; inset: 0; z-index: 8;
    pointer-events: none; opacity: 0;
    filter: invert(1);
  }
  .bird-wrap {
    position: absolute;
    animation: bird-cross linear infinite;
  }
  .bird-inner {
    animation: bird-bob ease-in-out infinite;
  }
  @keyframes bird-cross {
    from { transform: translateX(-70px); }
    to   { transform: translateX(calc(100vw + 70px)); }
  }
  @keyframes bird-bob {
    0%, 100% { transform: translateY(0); }
    50%       { transform: translateY(-13px); }
  }

  @media (max-width: 560px) {
    .apple-side { width: 320px; height: 347px; }
    #appleFill  { width: 320px; height: 347px; }
    .bio-inside { top: 115px; left: 64px; right: 64px; bottom: 21px; pointer-events: none; }
    .bio-para   { font-size: 7.5px; }
  }
</style>
</head>
<body>

  <!-- Stars -->
  <div class="star-field" id="starField"></div>

  <!-- Orchard background -->
  <div class="orchard-bg">
    <svg id="orchardSvg" viewBox="0 0 1440 900" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="chalk-orchard" x="-5%" y="-5%" width="110%" height="110%">
          <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" result="noise" seed="9"/>
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="2.2" xChannelSelector="R" yChannelSelector="G"/>
          <feGaussianBlur stdDeviation="0.4"/>
        </filter>
      </defs>
      <g id="orchardGroup" filter="url(#chalk-orchard)" opacity="0.50"></g>
    </svg>
  </div>

  <div class="chalk-dust" id="chalkDust"></div>
  <div class="vignette"></div>
  <div class="column-accent left"></div>
  <div class="column-accent right"></div>

  <div class="page-title">About</div>
  <a href="pomona.html" class="back-link">← return to the garden</a>

  <div class="lang-toggle">
    <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
    <span class="lang-sep">/</span>
    <button class="lang-btn" id="btn-fr" onclick="setLang('fr')">FR</button>
  </div>

  <div class="logo-container">
    <img src="LOGO_ANNAMAJIDSON_BLANC.png" alt="Pomona">
  </div>

  <!-- Fig music widget -->
  <div class="fig-widget">
    <div class="fig-toggle" onclick="togglePlayer()">
      <svg class="fig-svg" viewBox="0 0 38 44" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="chalk-fig" x="-20%" y="-15%" width="140%" height="130%">
            <feTurbulence type="fractalNoise" baseFrequency="0.62" numOctaves="2" result="noise" seed="14"/>
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.3" xChannelSelector="R" yChannelSelector="G"/>
            <feGaussianBlur stdDeviation="0.28"/>
          </filter>
        </defs>
        <g filter="url(#chalk-fig)">
          <path d="M 19 5 C 19 5, 19 11, 19 14" fill="none" stroke="rgba(230,225,215,0.78)" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M 19 14 C 12 16, 6 22, 6 30 C 6 37, 12 42, 19 42 C 26 42, 32 37, 32 30 C 32 22, 26 16, 19 14" fill="rgba(230,225,215,0.04)" stroke="rgba(230,225,215,0.84)" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M 19 33 L 19 41" fill="none" stroke="rgba(230,225,215,0.11)" stroke-width="0.8"/>
          <path d="M 19 14 C 12.5 16, 6.5 23, 6.5 30 C 6.5 37.5, 12.5 42.5, 19 43" fill="none" stroke="rgba(230,225,215,0.22)" stroke-width="0.9" stroke-dasharray="2.5 5" stroke-linecap="round"/>
        </g>
      </svg>
      <span class="fig-label">now playing</span>
      <span class="fig-track">Pomona EP</span>
      <div class="fig-playing-dot" id="playDot"></div>
    </div>
    <div class="player-panel" id="playerPanel">
      <iframe allow="autoplay *; encrypted-media *;" frameborder="0"
        sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation"
        src="https://embed.music.apple.com/fr/album/pomona-ep/1782326530?l=en-GB&autoPlay=1"></iframe>
    </div>
  </div>

  <!-- Main content -->
  <div class="main-layout">
    <div class="eat-prompt" id="eatPrompt">eat the apple</div>

    <div class="apple-side">
      <!-- Bio behind canvas — populated by JS -->
      <div class="bio-inside" id="bioInside"></div>

      <!-- Canvas: outline + fill drawn here — both get eaten on click -->
      <canvas id="appleFill" width="720" height="780"></canvas>
    </div>
  </div>

  <!-- Sun — triggered on full reveal -->
  <div class="sun" id="theSun"></div>

  <!-- Birds — appear after sun rises -->
  <div id="birdField"></div>

<script>
// ===================== CHALK DUST =====================
const dustContainer = document.getElementById('chalkDust');
for (let i = 0; i < 25; i++) {
  const p = document.createElement('div');
  p.className = 'dust-particle';
  p.style.left = Math.random() * 100 + '%';
  p.style.top  = (30 + Math.random() * 60) + '%';
  p.style.animationDuration = (5 + Math.random() * 10) + 's';
  p.style.animationDelay    = (Math.random() * 12) + 's';
  p.style.width = p.style.height = (1 + Math.random() * 1.5) + 'px';
  dustContainer.appendChild(p);
}

// ===================== FIG WIDGET =====================
let playerOpen = false;
function togglePlayer() {
  playerOpen = !playerOpen;
  document.getElementById('playerPanel').classList.toggle('open', playerOpen);
  document.getElementById('playDot').classList.toggle('active', playerOpen);
}

// ===================== LANGUAGE TOGGLE =====================
const BIO = {
  en: [
    "Anna Majidson is one of those rare voices on the new French and international music scene.",
    "Having emerged from the acclaimed duo Haute, which she formed with producer Blasé (also known as Romain Hainaut), the singer and producer has been carving out a unique musical path since 2020, imbued with refined references. Their Colors Session has over 32 million views to this day.",
    "With only four EPs, she has demonstrated her mastery of contemporary music codes while bringing her own distinctive touch to the French music scene, characterized by her use of the mandolin and the crafting of poetic yet catchy lyrics.",
    "She has also expanded her range of collaborations, working with French artists like rapper Nelick, singer Moodoïd, and musician November Ultra, as well as international names such as Seu Jorge and Macy Gray."
  ],
  fr: [
    "Anna Majidson est une de ses voix rares sur la nouvelle scène française et internationale.",
    "Échappée de l'excellent duo Haute qu'elle formait avec le producteur Blasé (ou Romain Hainaut à la ville), la chanteuse et productrice trace la voie, depuis 2020, d'un projet musical unique, teinté de références pointues. Leur Colors Session à obtenu plus de 30 millions de vues.",
    "En seulement trois EPs (Mixtape Telecom, La rivière et Ménagerie de Glass), elle a su prouver qu'elle maîtrisait les codes de son époque, tout en apportant au paysage musical français sa propre patte, marquée tantôt par son usage de la mandoline, tantôt par l'écriture de textes aussi poétiques qu'accrocheurs.",
    "En seulement trois ans, elle multiplie par ailleurs les collaborations, en France avec le rappeur nelick, le chanteur Moodoïd ou la musicienne November Ultra, comme à l'étranger avec Seu Jorge ou encore Macy Gray."
  ]
};
let currentLang = 'en';

function setLang(lang) {
  currentLang = lang;
  const el = document.getElementById('bioInside');
  el.innerHTML = BIO[lang].map(p => `<p class="bio-para">${p}</p>`).join('');
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.getElementById('btn-fr').classList.toggle('active', lang === 'fr');
}

// ===================== APPLE CANVAS =====================
const canvas = document.getElementById('appleFill');
const ctx    = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// All apple geometry — matches what we draw on canvas
const APPLE = {
  body: [
    [360,193], [418,121],[611,139],[641,270],
    [695,401],[691,557],[647,666],
    [600,772],[514,767],[360,767],
    [208,767],[120,772],[73,666],
    [29,557],[25,401],[79,270],
    [109,139],[304,121],[360,193]
  ],
  stemStart: [360,193], stemCP1: [358,157], stemCP2: [364,126], stemEnd: [376,102],
  leafStart: [376,144], leafCP1a: [402,109], leafCP1b: [449,106], leafMid: [462,132],
  leafCP2a: [442,150], leafCP2b: [402,150], leafEnd: [376,144],
  veinCP1: [406,126], veinCP2: [445,115],
  notchStart: [337,199], notchCP1: [349,180], notchCP2: [360,193], notchEnd: [376,181]
};

function drawAppleBodyPath() {
  const b = APPLE.body;
  ctx.moveTo(b[0][0], b[0][1]);
  ctx.bezierCurveTo(b[1][0],b[1][1], b[2][0],b[2][1], b[3][0],b[3][1]);
  ctx.bezierCurveTo(b[4][0],b[4][1], b[5][0],b[5][1], b[6][0],b[6][1]);
  ctx.bezierCurveTo(b[7][0],b[7][1], b[8][0],b[8][1], b[9][0],b[9][1]);
  ctx.bezierCurveTo(b[10][0],b[10][1], b[11][0],b[11][1], b[12][0],b[12][1]);
  ctx.bezierCurveTo(b[13][0],b[13][1], b[14][0],b[14][1], b[15][0],b[15][1]);
  ctx.bezierCurveTo(b[16][0],b[16][1], b[17][0],b[17][1], b[18][0],b[18][1]);
  ctx.closePath();
}

function chalkStroke(jx, jy, color, width, dash) {
  ctx.save();
  ctx.translate((Math.random()-0.5)*jx, (Math.random()-0.5)*jy);
  ctx.beginPath();
  drawAppleBodyPath();
  ctx.strokeStyle = color;
  ctx.lineWidth   = width;
  ctx.lineCap = ctx.lineJoin = 'round';
  if (dash) ctx.setLineDash(dash);
  ctx.stroke();
  ctx.setLineDash([]);
  ctx.restore();
}

function initApple() {
  ctx.clearRect(0, 0, W, H);

  // 1. Cover entire canvas so text is hidden
  ctx.fillStyle = '#080808';
  ctx.fillRect(0, 0, W, H);

  // 2. Apple body outline — multiple chalk passes
  // Soft inner glow (wide, very faint)
  chalkStroke(0, 0, 'rgba(230,225,215,0.07)', 7, null);
  // Dashed texture pass (slightly offset)
  chalkStroke(1.2, 1.2, 'rgba(230,225,215,0.22)', 1.1, [5, 9]);
  // Main crisp stroke
  chalkStroke(0, 0, 'rgba(230,225,215,0.88)', 2.4, null);
  // Fine highlight pass (offset right-up)
  ctx.save();
  ctx.translate(0.6, -0.6);
  ctx.beginPath();
  drawAppleBodyPath();
  ctx.strokeStyle = 'rgba(230,225,215,0.18)';
  ctx.lineWidth = 0.8;
  ctx.lineCap = ctx.lineJoin = 'round';
  ctx.stroke();
  ctx.restore();

  // 3. Stem
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(...APPLE.stemStart);
  ctx.bezierCurveTo(...APPLE.stemCP1, ...APPLE.stemCP2, ...APPLE.stemEnd);
  ctx.strokeStyle = 'rgba(230,225,215,0.72)'; ctx.lineWidth = 2.2; ctx.lineCap = 'round';
  ctx.stroke();
  // stem second pass
  ctx.translate(0.5, 0.5);
  ctx.beginPath();
  ctx.moveTo(...APPLE.stemStart);
  ctx.bezierCurveTo(...APPLE.stemCP1, ...APPLE.stemCP2, ...APPLE.stemEnd);
  ctx.strokeStyle = 'rgba(230,225,215,0.2)'; ctx.lineWidth = 0.8;
  ctx.setLineDash([3,5]); ctx.stroke(); ctx.setLineDash([]);
  ctx.restore();

  // 4. Leaf
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(...APPLE.leafStart);
  ctx.bezierCurveTo(...APPLE.leafCP1a, ...APPLE.leafCP1b, ...APPLE.leafMid);
  ctx.bezierCurveTo(...APPLE.leafCP2a, ...APPLE.leafCP2b, ...APPLE.leafEnd);
  ctx.closePath();
  ctx.fillStyle = 'rgba(230,225,215,0.05)'; ctx.fill();
  ctx.strokeStyle = 'rgba(230,225,215,0.54)'; ctx.lineWidth = 1.4; ctx.lineCap = 'round'; ctx.stroke();
  // vein
  ctx.beginPath();
  ctx.moveTo(...APPLE.leafStart);
  ctx.bezierCurveTo(...APPLE.veinCP1, ...APPLE.veinCP2, ...APPLE.leafMid);
  ctx.strokeStyle = 'rgba(230,225,215,0.18)'; ctx.lineWidth = 0.8; ctx.stroke();
  ctx.restore();

  // 5. Notch dent
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(...APPLE.notchStart);
  ctx.bezierCurveTo(...APPLE.notchCP1, ...APPLE.notchCP2, ...APPLE.notchEnd);
  ctx.strokeStyle = 'rgba(230,225,215,0.38)'; ctx.lineWidth = 1.4; ctx.lineCap = 'round'; ctx.stroke();
  ctx.restore();

  // 6. Left highlight
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(150,376); ctx.bezierCurveTo(120,484,126,600,172,666);
  ctx.strokeStyle = 'rgba(230,225,215,0.07)'; ctx.lineWidth = 3.5; ctx.lineCap = 'round'; ctx.stroke();
  ctx.restore();
}

// ===================== REVEAL TRACKING =====================
// appleBodyPixels = only pixels inside the apple silhouette (not the full canvas rectangle)
// This is what we measure progress against so pct reaches 1 when the apple body is fully eaten
// Area-based reveal: accumulate bite circle areas — no per-bite pixel scanning
let appleBodyPixels = 0;  // set at boot
let totalBiteArea   = 0;  // running total of approximate erased area
const bioInside = document.getElementById('bioInside');

function measureAppleBodyPixels() {
  try {
    const off = document.createElement('canvas');
    off.width = W; off.height = H;
    const offCtx = off.getContext('2d');
    const b = APPLE.body;
    offCtx.beginPath();
    offCtx.moveTo(b[0][0],b[0][1]);
    offCtx.bezierCurveTo(b[1][0],b[1][1],b[2][0],b[2][1],b[3][0],b[3][1]);
    offCtx.bezierCurveTo(b[4][0],b[4][1],b[5][0],b[5][1],b[6][0],b[6][1]);
    offCtx.bezierCurveTo(b[7][0],b[7][1],b[8][0],b[8][1],b[9][0],b[9][1]);
    offCtx.bezierCurveTo(b[10][0],b[10][1],b[11][0],b[11][1],b[12][0],b[12][1]);
    offCtx.bezierCurveTo(b[13][0],b[13][1],b[14][0],b[14][1],b[15][0],b[15][1]);
    offCtx.bezierCurveTo(b[16][0],b[16][1],b[17][0],b[17][1],b[18][0],b[18][1]);
    offCtx.closePath();
    offCtx.fillStyle = '#fff';
    offCtx.fill();
    const data = offCtx.getImageData(0, 0, W, H).data;
    let n = 0;
    for (let i = 3; i < data.length; i += 4) if (data[i] > 10) n++;
    return n;
  } catch(e) {
    return Math.round(W * H * 0.62); // fallback if getImageData is blocked
  }
}

function scheduleReveal(radius) {
  // Add approximate area of this bite (core circle × overlap factor 0.55)
  totalBiteArea += Math.PI * Math.pow(radius * 0.72, 2) * 0.55;
  if (!appleBodyPixels) return;
  const pct = Math.min(1, totalBiteArea / appleBodyPixels);
  canvas.style.opacity    = 1 - pct;
  bioInside.style.opacity = pct;
  if (pct >= 0.75 && !finaleTriggered) {
    finaleTriggered = true;
    setTimeout(triggerFinale, 700);
  }
}

// ===================== BITE MECHANIC =====================
let firstBite = false;
let isDown = false;

function bite(cx, cy, radius) {
  if (!firstBite) {
    firstBite = true;
    document.getElementById('eatPrompt').classList.add('hidden');
  }

  ctx.save();
  ctx.globalCompositeOperation = 'destination-out';

  // Main bite core (clean, larger circle)
  ctx.beginPath();
  ctx.arc(cx, cy, radius * 0.72, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(0,0,0,1)';
  ctx.fill();

  // Ragged chalk edge — irregular circles around perimeter
  for (let i = 0; i < 10; i++) {
    const angle = (i / 10) * Math.PI * 2 + Math.random() * 0.6;
    const dist  = radius * (0.45 + Math.random() * 0.55);
    const r     = radius * (0.18 + Math.random() * 0.32);
    ctx.beginPath();
    ctx.arc(cx + Math.cos(angle)*dist, cy + Math.sin(angle)*dist, r, 0, Math.PI*2);
    ctx.fill();
  }

  // A couple extra off-center for extra roughness
  for (let i = 0; i < 3; i++) {
    ctx.beginPath();
    ctx.arc(
      cx + (Math.random()-0.5)*radius*1.1,
      cy + (Math.random()-0.5)*radius*1.1,
      radius * (0.1 + Math.random()*0.2), 0, Math.PI*2
    );
    ctx.fill();
  }

  ctx.restore();
  spawnBiteDust(cx, cy, radius);
  scheduleReveal(radius);
}

function spawnBiteDust(cx, cy, radius) {
  const rect = canvas.getBoundingClientRect();
  const sx = rect.width  / W;
  const sy = rect.height / H;
  const count = Math.floor(3 + radius / 8);
  for (let i = 0; i < count; i++) {
    const d = document.createElement('div');
    d.className = 'bite-dust';
    const angle = Math.random() * Math.PI * 2;
    const dist  = 10 + Math.random() * 30;
    d.style.setProperty('--dx', (Math.cos(angle)*dist) + 'px');
    d.style.setProperty('--dy', (Math.sin(angle)*dist - 20) + 'px');
    d.style.left = (rect.left + cx*sx + (Math.random()-0.5)*10) + 'px';
    d.style.top  = (rect.top  + cy*sy + (Math.random()-0.5)*6) + 'px';
    d.style.width = d.style.height = (1.5 + Math.random()*2) + 'px';
    document.body.appendChild(d);
    setTimeout(() => d.remove(), 1100);
  }
}

function getPos(clientX, clientY) {
  const r = canvas.getBoundingClientRect();
  return [(clientX-r.left)*(W/r.width), (clientY-r.top)*(H/r.height)];
}

canvas.addEventListener('mousedown', e => { isDown=true; bite(...getPos(e.clientX,e.clientY), 36); });
canvas.addEventListener('mousemove', e => { if(isDown) bite(...getPos(e.clientX,e.clientY), 28); });
canvas.addEventListener('mouseup',    () => isDown=false);
canvas.addEventListener('mouseleave', () => isDown=false);
canvas.addEventListener('touchstart', e => { e.preventDefault(); isDown=true; bite(...getPos(e.touches[0].clientX,e.touches[0].clientY),42); }, {passive:false});
canvas.addEventListener('touchmove',  e => { e.preventDefault(); if(isDown) bite(...getPos(e.touches[0].clientX,e.touches[0].clientY),32); }, {passive:false});
canvas.addEventListener('touchend',   () => isDown=false);

// ===================== ORCHARD =====================
(function buildOrchard() {
  const NS  = 'http://www.w3.org/2000/svg';
  const grp = document.getElementById('orchardGroup');

  function el(tag, attrs) {
    const e = document.createElementNS(NS, tag);
    for (const [k,v] of Object.entries(attrs)) e.setAttribute(k, v);
    return e;
  }

  function tree(cx, base, H, R, tw, rowAlpha) {
    const g   = el('g', {});
    const topY = base - H;
    const cy   = topY - R * 0.38;
    const s    = `rgba(230,225,215,${rowAlpha})`;
    const sd   = `rgba(230,225,215,${rowAlpha*0.5})`;

    // Ground shadow
    g.appendChild(el('ellipse', { cx, cy:base, rx:R*0.65, ry:5, fill:'none', stroke:sd, 'stroke-width':0.8 }));

    // Trunk (two curved lines)
    g.appendChild(el('path', { d:`M ${cx-tw/2} ${base} C ${cx-tw/3} ${base-H*0.45} ${cx-1} ${base-H*0.78} ${cx} ${topY}`, fill:'none', stroke:s, 'stroke-width':tw*0.45, 'stroke-linecap':'round' }));
    g.appendChild(el('path', { d:`M ${cx+tw/2} ${base} C ${cx+tw/3} ${base-H*0.45} ${cx+1} ${base-H*0.78} ${cx} ${topY}`, fill:'none', stroke:s, 'stroke-width':tw*0.45, 'stroke-linecap':'round' }));

    // Canopy circles (main + bumps for rounded Greek tree shape)
    const canopyFill = `rgba(230,225,215,0.02)`;
    g.appendChild(el('circle', { cx, cy, r:R, fill:canopyFill, stroke:s, 'stroke-width':1.4 }));
    g.appendChild(el('circle', { cx:cx-R*0.52, cy:cy+R*0.16, r:R*0.7, fill:'none', stroke:sd, 'stroke-width':0.9 }));
    g.appendChild(el('circle', { cx:cx+R*0.52, cy:cy+R*0.16, r:R*0.7, fill:'none', stroke:sd, 'stroke-width':0.9 }));
    g.appendChild(el('circle', { cx, cy:cy-R*0.44, r:R*0.62, fill:'none', stroke:sd, 'stroke-width':0.8 }));

    // Apple dots hanging in canopy
    const dots = [[-0.28,0.28,2.4],[0.32,0.06,2],[0.0,0.42,2.2],[-0.45,0.08,1.8]];
    for (const [dx,dy,dr] of dots) {
      g.appendChild(el('circle', { cx:cx+R*dx, cy:cy+R*dy, r:dr, fill:'none', stroke:`rgba(230,225,215,${rowAlpha*0.8})`, 'stroke-width':0.8 }));
    }

    grp.appendChild(g);
  }

  function urn(cx, base, scale) {
    const g  = el('g', {});
    const s  = scale;
    const st = `rgba(230,225,215,0.75)`;
    // Body profile
    g.appendChild(el('path', { d:`M ${cx-11*s} ${base} C ${cx-9*s} ${base-12*s} ${cx-13*s} ${base-26*s} ${cx-9*s} ${base-40*s} L ${cx-7*s} ${base-48*s} Q ${cx} ${base-56*s} ${cx+7*s} ${base-48*s} L ${cx+9*s} ${base-40*s} C ${cx+13*s} ${base-26*s} ${cx+9*s} ${base-12*s} ${cx+11*s} ${base}`, fill:'none', stroke:st, 'stroke-width':0.9, 'stroke-linecap':'round', 'stroke-linejoin':'round' }));
    // Rim
    g.appendChild(el('ellipse', { cx, cy:base-48*s, rx:8*s, ry:3.5*s, fill:'none', stroke:st, 'stroke-width':0.9 }));
    // Handles
    g.appendChild(el('path', { d:`M ${cx-9*s} ${base-44*s} Q ${cx-18*s} ${base-38*s} ${cx-9*s} ${base-30*s}`, fill:'none', stroke:st, 'stroke-width':0.8, 'stroke-linecap':'round' }));
    g.appendChild(el('path', { d:`M ${cx+9*s} ${base-44*s} Q ${cx+18*s} ${base-38*s} ${cx+9*s} ${base-30*s}`, fill:'none', stroke:st, 'stroke-width':0.8, 'stroke-linecap':'round' }));
    // Foot
    g.appendChild(el('ellipse', { cx, cy:base, rx:12*s, ry:4*s, fill:'none', stroke:st, 'stroke-width':0.8 }));
    grp.appendChild(g);
  }

  function column(cx, base, H) {
    const g  = el('g', {});
    const st = `rgba(230,225,215,0.7)`;
    // Fluted shaft (two lines)
    g.appendChild(el('line', { x1:cx-5, y1:base, x2:cx-6, y2:base-H, stroke:st, 'stroke-width':1, 'stroke-linecap':'round' }));
    g.appendChild(el('line', { x1:cx+5, y1:base, x2:cx+6, y2:base-H, stroke:st, 'stroke-width':1, 'stroke-linecap':'round' }));
    // Middle shaft lines (fluting hint)
    g.appendChild(el('line', { x1:cx-1, y1:base, x2:cx-1, y2:base-H, stroke:`rgba(230,225,215,0.3)`, 'stroke-width':0.6 }));
    g.appendChild(el('line', { x1:cx+2, y1:base, x2:cx+2, y2:base-H, stroke:`rgba(230,225,215,0.2)`, 'stroke-width':0.5 }));
    // Capital (echinus + abacus)
    g.appendChild(el('path', { d:`M ${cx-6} ${base-H} Q ${cx-10} ${base-H-6} ${cx-13} ${base-H-10} L ${cx+13} ${base-H-10} Q ${cx+10} ${base-H-6} ${cx+6} ${base-H}`, fill:'none', stroke:st, 'stroke-width':1.1, 'stroke-linecap':'round', 'stroke-linejoin':'round' }));
    g.appendChild(el('line', { x1:cx-14, y1:base-H-10, x2:cx+14, y2:base-H-10, stroke:st, 'stroke-width':1.3, 'stroke-linecap':'round' }));
    // Stylobate base
    g.appendChild(el('line', { x1:cx-9, y1:base, x2:cx+9, y2:base, stroke:st, 'stroke-width':1.2, 'stroke-linecap':'round' }));
    grp.appendChild(g);
  }

  function stoneWall(y, width) {
    const g = el('g', {});
    const st = `rgba(230,225,215,0.6)`;
    // Top & bottom edges
    g.appendChild(el('line', { x1:0, y1:y,       x2:width, y2:y,       stroke:st, 'stroke-width':0.85 }));
    g.appendChild(el('line', { x1:0, y1:y+14,     x2:width, y2:y+14,   stroke:st, 'stroke-width':0.7 }));
    // Stone block joints (irregular spacing)
    const joints = [70,165,285,395,510,615,730,850,960,1070,1180,1300,1390];
    for (const x of joints) {
      g.appendChild(el('line', { x1:x, y1:y, x2:x+2, y2:y+14, stroke:`rgba(230,225,215,0.35)`, 'stroke-width':0.8 }));
    }
    grp.appendChild(g);
  }

  // ---- FAR ROW (y_base=480) ----
  const farTree = [
    [180,480,58,20,4.5],
    [400,480,60,21,5],
    [640,480,62,22,5],
    [890,480,60,21,5],
    [1120,480,58,20,4.5],
    [1340,480,55,18,4],
  ];
  for (const [cx,base,H,R,tw] of farTree) tree(cx, base, H, R, tw, 0.55);

  // ---- STONE WALL ----
  stoneWall(492, 1440);

  // ---- COLUMNS (near horizon, centre) ----
  column(580, 490, 82);
  column(720, 490, 88);
  column(860, 490, 82);

  // ---- MIDDLE ROW (y_base=660) ----
  const midTree = [
    [70, 660,108,38,8],
    [330,660,110,40,9],
    [650,660,115,42,9],
    [1010,660,115,42,9],
    [1320,660,110,40,9],
  ];
  for (const [cx,base,H,R,tw] of midTree) tree(cx, base, H, R, tw, 0.72);

  // ---- URNS ----
  urn(490, 660, 1);
  urn(820, 660, 1);
  urn(1160, 660, 1);

  // ---- NEAR ROW (y_base=850, large trees, partial) ----
  tree(120,  850, 165, 58, 12, 0.55);
  tree(1320, 850, 165, 58, 12, 0.55);

  // ---- GROUND LINE ----
  grp.appendChild(el('line', { x1:0, y1:695, x2:1440, y2:695, stroke:`rgba(230,225,215,0.25)`, 'stroke-width':0.8 }));
  // Perspective converging lines from edges to horizon centre
  grp.appendChild(el('line', { x1:0, y1:900, x2:720, y2:460, stroke:`rgba(230,225,215,0.06)`, 'stroke-width':0.8 }));
  grp.appendChild(el('line', { x1:1440, y1:900, x2:720, y2:460, stroke:`rgba(230,225,215,0.06)`, 'stroke-width':0.8 }));
})();

// ===================== FINALE =====================
let finaleTriggered = false;

function spawnBirds() {
  const field = document.getElementById('birdField');
  const colors = ['#d94040','#4a9cd4','#e8c030','#48b040','#9044c0','#e87028','#d44080','#2eb090'];

  for (let i = 0; i < 26; i++) {
    const wrap  = document.createElement('div');
    wrap.className = 'bird-wrap';
    const inner = document.createElement('div');
    inner.className = 'bird-inner';

    const color     = colors[i % colors.length];
    const span      = 12 + Math.random() * 17;          // wingspan 12–29 px
    const y         = 5  + Math.random() * 55;          // top 5–60% of screen
    const crossDur  = 9  + Math.random() * 19;          // 9–28 s to cross
    const bobDur    = 0.4 + Math.random() * 0.6;        // 0.4–1 s per flap

    inner.innerHTML = `<svg viewBox="-22 -12 44 14" width="${span.toFixed(0)}" height="${(span*0.32).toFixed(0)}" xmlns="http://www.w3.org/2000/svg">
      <path d="M-18,-3 C-11,-11,-3,-4,0,0 C3,-4,11,-11,18,-3" fill="${color}" opacity="0.9"/>
    </svg>`;

    wrap.appendChild(inner);
    wrap.style.top              = y + '%';
    wrap.style.animationDuration  = crossDur + 's';
    wrap.style.animationDelay     = '-' + (Math.random() * crossDur).toFixed(1) + 's';
    inner.style.animationDuration = bobDur + 's';
    inner.style.animationDelay    = '-' + (Math.random() * bobDur).toFixed(2) + 's';
    field.appendChild(wrap);
  }

  field.style.transition = 'opacity 2s ease';
  field.style.opacity    = '1';
}

function triggerFinale() {
  const sun = document.getElementById('theSun');

  // Stars fade out before inversion
  const sf = document.getElementById('starField');
  sf.style.transition = 'opacity 1.2s ease';
  sf.style.opacity    = '0';

  // Sun rises from below
  sun.classList.add('rising');

  // Inversion sweeps in 1.4s after sun starts climbing
  setTimeout(() => document.documentElement.classList.add('inverted'), 1400);

  // Birds arrive once the world has turned bright
  setTimeout(spawnBirds, 4200);
}

// ===================== CURSOR =====================
(function setCursor() {
  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="0 0 24 40">
    <circle cx="12" cy="5.5" r="4" fill="none" stroke="#e6e1d7" stroke-width="1.4"/>
    <line x1="12" y1="9.5" x2="12" y2="20" stroke="#e6e1d7" stroke-width="1.3" stroke-linecap="round"/>
    <path d="M12 14 C10 10,7 7,4 6" fill="none" stroke="#e6e1d7" stroke-width="1.1" stroke-linecap="round"/>
    <path d="M12 14 C15 13,18 14,20 17" fill="none" stroke="#e6e1d7" stroke-width="1.1" stroke-linecap="round"/>
    <path d="M12 20 C10 26,7 32,6 40" fill="none" stroke="#e6e1d7" stroke-width="1.2" stroke-linecap="round"/>
    <path d="M12 20 C14 26,17 32,18 40" fill="none" stroke="#e6e1d7" stroke-width="1.2" stroke-linecap="round"/>
    <path d="M12 20 C12 27,12 33,12 40" fill="none" stroke="#e6e1d7" stroke-width="0.6" stroke-linecap="round" opacity="0.4"/>
  </svg>`;
  const url = 'data:image/svg+xml;base64,' + btoa(svg);
  document.documentElement.style.cursor = `url("${url}") 12 5, auto`;
})();

// ===================== STARS =====================
(function buildStars() {
  const field = document.getElementById('starField');
  for (let i = 0; i < 110; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = 1 + Math.random() * 2.2;
    s.style.width = s.style.height = size + 'px';
    s.style.left = (Math.random() * 100) + '%';
    s.style.top  = (Math.random() * 100) + '%';
    s.style.animationDuration = (2.5 + Math.random() * 5) + 's';
    s.style.animationDelay   = (-Math.random() * 8) + 's';
    const g = (size * 4).toFixed(1);
    s.style.boxShadow = `0 0 ${g}px rgba(230,225,215,0.7)`;
    field.appendChild(s);
  }
})();

// ===================== BOOT =====================
setLang('en');
initApple();
appleBodyPixels = measureAppleBodyPixels();

// Auto-activate playing dot once widget has faded in
setTimeout(() => {
  document.getElementById('playDot').classList.add('active');
}, 3000);
</script>
</body>
</html>
